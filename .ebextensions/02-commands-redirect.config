container_commands:
   01-webconfig-clear:
     command: C:/Windows/System32/inetsrv/appcmd.exe set config "Default Web Site" -section:system.webServer/rewrite/rules /-"[name='ELB_HTTP_redirect']" >> log.txt 2>&1
     cwd: "C:/inetpub/wwwroot"
     ignoreErrors: true
   02-webconfig-addrule:
     command: C:/Windows/System32/inetsrv/appcmd.exe set config "Default Web Site" -section:system.webServer/rewrite/rules /+"[name='ELB_HTTP_redirect',enabled='true',stopProcessing='true']" >> log.txt 2>&1
     cwd: "C:/inetpub/wwwroot"
   03-webconfig-addmatch:
     command: C:/Windows/System32/inetsrv/appcmd.exe set config "Default Web Site" -section:system.webServer/rewrite/rules /"[name='ELB_HTTP_redirect'].match.url:"^^(.*)$"" >> log.txt 2>&1
     cwd: "C:/inetpub/wwwroot"
   04-webconfig-addcond1:
     command: C:/Windows/System32/inetsrv/appcmd.exe set config "Default Web Site" -section:system.webServer/rewrite/rules /+"[name='ELB_HTTP_redirect'].conditions.[input='{HTTP_X_FORWARDED_PROTO}',pattern='^http$']" >> log.txt 2>&1
     cwd: "C:/inetpub/wwwroot"
   05-webconfig-addcond2:
     command: C:/Windows/System32/inetsrv/appcmd.exe set config "Default Web Site" -section:system.webServer/rewrite/rules /+"[name='ELB_HTTP_redirect'].conditions.[input='{URL}',pattern='^(.)*/default.aspx$',negate='true']" >> log.txt 2>&1
     cwd: "C:/inetpub/wwwroot"
   06-webconfig-addaction:
     command: C:/Windows/System32/inetsrv/appcmd.exe set config "Default Web Site" -section:system.webServer/rewrite/rules /"[name='ELB_HTTP_redirect'].action.type:"Redirect"" /"[name='ELB_HTTP_redirect'].action.url:"https://{SERVER_NAME}{URL}"" >> log.txt 2>&1
     cwd: "C:/inetpub/wwwroot"
   07-iisreset:
     command: iisreset >> log.txt 2>&1
     cwd: "C:/inetpub/wwwroot"
